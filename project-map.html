<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UYAP Dosya İndirici v2 - Proje Haritası</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      font-size: 14px;
      line-height: 1.6;
      color: #1f2937;
      background: #f3f4f6;
      height: 100vh;
      overflow: hidden;
    }
    header {
      background: #1e293b;
      color: #f8fafc;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 3px solid #3b82f6;
    }
    header h1 { font-size: 16px; font-weight: 600; }
    header span { font-size: 12px; color: #94a3b8; }
    .container {
      display: flex;
      height: calc(100vh - 51px);
    }
    .tree-panel {
      width: 320px;
      min-width: 280px;
      background: #ffffff;
      border-right: 1px solid #e5e7eb;
      overflow-y: auto;
      padding: 8px 0;
    }
    .tree-panel::-webkit-scrollbar { width: 6px; }
    .tree-panel::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    .tree-folder { cursor: pointer; user-select: none; }
    .tree-folder-header {
      display: flex;
      align-items: center;
      padding: 4px 8px;
      gap: 4px;
      font-weight: 600;
      font-size: 13px;
      color: #374151;
    }
    .tree-folder-header:hover { background: #f3f4f6; }
    .tree-arrow {
      display: inline-block;
      width: 16px;
      text-align: center;
      font-size: 10px;
      color: #6b7280;
      transition: transform 0.15s;
      flex-shrink: 0;
    }
    .tree-arrow.open { transform: rotate(90deg); }
    .tree-folder-icon { color: #f59e0b; margin-right: 2px; flex-shrink: 0; }
    .tree-children { display: none; }
    .tree-children.open { display: block; }
    .tree-file {
      display: flex;
      align-items: center;
      padding: 3px 8px 3px 28px;
      cursor: pointer;
      font-size: 13px;
      color: #4b5563;
      gap: 6px;
      border-left: 3px solid transparent;
    }
    .tree-file:hover { background: #eff6ff; }
    .tree-file.active {
      background: #dbeafe;
      color: #1e40af;
      border-left-color: #3b82f6;
      font-weight: 500;
    }
    .tree-file-icon { color: #6b7280; font-size: 12px; flex-shrink: 0; }
    .tree-file-icon.ts { color: #3178c6; }
    .tree-file-icon.tsx { color: #61dafb; }
    .tree-file-icon.css { color: #a855f7; }
    .tree-file-icon.json { color: #eab308; }
    .tree-file-icon.html { color: #f97316; }
    .tree-file-icon.js { color: #eab308; }
    .detail-panel {
      flex: 1;
      overflow-y: auto;
      padding: 24px 32px;
    }
    .detail-panel::-webkit-scrollbar { width: 6px; }
    .detail-panel::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    .detail-empty {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: #9ca3af;
      font-size: 15px;
    }
    .detail-path {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 4px;
      font-family: "Cascadia Code", "Fira Code", monospace;
    }
    .detail-title {
      font-size: 20px;
      font-weight: 700;
      color: #111827;
      margin-bottom: 8px;
    }
    .detail-desc {
      font-size: 14px;
      color: #4b5563;
      margin-bottom: 20px;
      padding: 12px 16px;
      background: #f0f9ff;
      border-left: 4px solid #3b82f6;
      border-radius: 0 6px 6px 0;
    }
    .detail-section { margin-bottom: 16px; }
    .detail-section-title {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #6b7280;
      margin-bottom: 8px;
      padding-bottom: 4px;
      border-bottom: 1px solid #e5e7eb;
    }
    .detail-list { list-style: none; padding: 0; }
    .detail-list li {
      font-size: 13px;
      padding: 3px 0;
      font-family: "Cascadia Code", "Fira Code", monospace;
      color: #374151;
    }
    .detail-list li::before {
      content: "\2022";
      color: #3b82f6;
      margin-right: 8px;
    }
    .detail-none {
      font-size: 13px;
      color: #9ca3af;
      font-style: italic;
    }
  </style>
</head>
<body>
  <header>
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2"><path d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
    <h1>UYAP Dosya İndirici v2</h1>
    <span>Proje Kaynak Kod Haritası - 37 dosya</span>
  </header>
  <div class="container">
    <div class="tree-panel" id="tree"></div>
    <div class="detail-panel" id="detail">
      <div class="detail-empty">Sol panelden bir dosya seçin</div>
    </div>
  </div>

  <script>
const FILES = {
  "package.json": {
    path: "package.json",
    desc: "Proje bağımlılıkları ve npm scriptlerini tanımlar (preact, vite, tailwindcss, crxjs).",
    imports: ["yok (JSON dosyası)"],
    vars: [],
    consts: [],
    funcs: []
  },
  "vite.config.ts": {
    path: "vite.config.ts",
    desc: "Vite build yapılandırması; Preact preset, CRX plugin ve path alias tanımları.",
    imports: ["defineConfig (vite)", "preact (@preact/preset-vite)", "crx (@crxjs/vite-plugin)", "manifest (./src/manifest)"],
    vars: [],
    consts: [],
    funcs: []
  },
  "tailwind.config.ts": {
    path: "tailwind.config.ts",
    desc: "Tailwind CSS yapılandırması; 'uyap-' prefix'i ve preflight:false ayarı ile UYAP stilleriyle çatışmayı önler.",
    imports: ["Config (tailwindcss) [type]"],
    vars: [],
    consts: [],
    funcs: []
  },
  "postcss.config.js": {
    path: "postcss.config.js",
    desc: "PostCSS yapılandırması; tailwindcss ve autoprefixer pluginlerini yükler.",
    imports: [],
    vars: [],
    consts: [],
    funcs: []
  },
  "tsconfig.json": {
    path: "tsconfig.json",
    desc: "TypeScript derleyici ayarları; strict mod, path alias'lar, Preact JSX ve Chrome Extension type tanımları.",
    imports: ["yok (JSON dosyası)"],
    vars: [],
    consts: [],
    funcs: []
  },
  "tsconfig.node.json": {
    path: "tsconfig.node.json",
    desc: "Vite config dosyası için ayrı TypeScript yapılandırması (composite, bundler moduleResolution).",
    imports: ["yok (JSON dosyası)"],
    vars: [],
    consts: [],
    funcs: []
  },
  "src/manifest.ts": {
    path: "src/manifest.ts",
    desc: "Chrome Extension Manifest V3 tanımını defineManifest() ile programatik olarak oluşturur; permissions, host_permissions, content_scripts ve background service worker kaydı.",
    imports: ["defineManifest (@crxjs/vite-plugin)"],
    vars: [],
    consts: [],
    funcs: []
  },
  "src/types/index.ts": {
    path: "src/types/index.ts",
    desc: "Projedeki tüm TypeScript interface ve type tanımları; evrak, dosya, indirme, ayarlar, export ve mesajlaşma tipleri.",
    imports: [],
    vars: [],
    consts: [],
    funcs: [],
    extra: {
      title: "Interface / Type Tanımları",
      items: [
        "EvrakItem (interface)",
        "DosyaBilgileri (interface)",
        "PaginationInfo (interface)",
        "DownloadStatus (type)",
        "DownloadProgress (interface)",
        "DownloadStartPayload (interface)",
        "DownloadProgressPayload (interface)",
        "DownloadState (interface)",
        "Settings (interface)",
        "ExportData (interface)",
        "WriteFilePayload (interface)",
        "WriteFileResponse (interface)",
        "MessageType (type)",
        "Message (interface)"
      ]
    }
  },
  "src/types/filesystem.d.ts": {
    path: "src/types/filesystem.d.ts",
    desc: "File System Access API için TypeScript tip genişletmesi; queryPermission ve requestPermission metotlarını FileSystemDirectoryHandle'a ekler.",
    imports: [],
    vars: [],
    consts: [],
    funcs: [],
    extra: {
      title: "Interface Augmentation",
      items: ["FileSystemDirectoryHandle (queryPermission, requestPermission)"]
    }
  },
  "src/store/index.ts": {
    path: "src/store/index.ts",
    desc: "Store modülü barrel export dosyası; signals.ts'deki tüm export'ları re-export eder.",
    imports: ["* from './signals' (re-export)"],
    vars: [],
    consts: [],
    funcs: []
  },
  "src/store/signals.ts": {
    path: "src/store/signals.ts",
    desc: "Preact Signals ile tüm reaktif state yönetimi; signal'lar, computed değerler ve state güncelleme helper fonksiyonları.",
    imports: [
      "signal, computed (@preact/signals)",
      "EvrakItem, DosyaBilgileri, DownloadState, Settings, ExportData, PaginationInfo (@/types)",
      "DEFAULT_SETTINGS (@lib)"
    ],
    vars: [
      "evraklar (signal<EvrakItem[]>)",
      "seciliEvrakIds (signal<Set<string>>)",
      "indirmeDurumu (signal<DownloadState>)",
      "dosyaBilgileri (signal<DosyaBilgileri | null>)",
      "ayarlar (signal<Settings>)",
      "mevcutExport (signal<ExportData | null>)",
      "sessionExpired (signal<boolean>)",
      "paginationInfo (signal<PaginationInfo | null>)",
      "kisiAdi (signal<string>)"
    ],
    consts: [],
    funcs: [
      "grupluEvraklar (computed)",
      "deltaInfo (computed)",
      "seciliEvrakSayisi (computed)",
      "indirmeYuzdesi (computed)",
      "toggleEvrakSecimi(evrakId)",
      "tumunuSec()",
      "secimiTemizle()",
      "klasorEvraklariniSec(klasorAdi)",
      "klasorEvraklariniKaldir(klasorAdi)",
      "updateDownloadProgress(completedCount, failedCount)",
      "resetDownloadState()"
    ]
  },
  "src/lib/index.ts": {
    path: "src/lib/index.ts",
    desc: "Lib modülü barrel export dosyası; constants, messages, filename ve export-io modüllerini re-export eder.",
    imports: [
      "* from './constants' (re-export)",
      "* from './messages' (re-export)",
      "* from './filename' (re-export)",
      "* from './export-io' (re-export)"
    ],
    vars: [],
    consts: [],
    funcs: []
  },
  "src/lib/constants.ts": {
    path: "src/lib/constants.ts",
    desc: "Tüm sabit değerler: UYAP endpointleri, magic bytes, MIME tipleri, DOM selektörleri, varsayılan ayarlar, IndexedDB ve retry yapılandırması.",
    imports: [],
    vars: [],
    consts: [
      "UYAP_BASE_URL",
      "DOWNLOAD_ENDPOINT",
      "MAGIC_BYTES (PDF, ZIP, TIFF_LE, TIFF_BE)",
      "MIME_TYPES (PDF, UDF, TIFF, HTML, UNKNOWN)",
      "FILE_EXTENSIONS (PDF, UDF, TIFF, HTML)",
      "SELECTORS (FILETREE, MODAL, YARGI_TURU_SELECT, USERNAME, FILE_SPAN, FOLDER_SPAN, EVRAK_RESULT)",
      "SKIP_FOLDERS",
      "DEFAULT_SETTINGS (downloadDelay, autoRetry, keepFolderStructure)",
      "DEFAULT_YARGI_TURU",
      "IDB_CONFIG (DB_NAME, STORE_NAME, VERSION)",
      "STORAGE_KEYS (SETTINGS, DIRECTORY_HANDLE, LAST_EXPORT)",
      "RETRY_CONFIG (MAX_RETRIES, BASE_DELAY, DELAY_MULTIPLIER)",
      "EXPORT_FILE_NAME"
    ],
    funcs: []
  },
  "src/lib/messages.ts": {
    path: "src/lib/messages.ts",
    desc: "Chrome Extension mesajlaşma altyapısı; content, background ve popup arasındaki iletişim fonksiyonları.",
    imports: ["Message, MessageType (@/types)"],
    vars: [],
    consts: [],
    funcs: [
      "sendToBackground<T>(type, payload): Promise<T>",
      "sendToContent<T>(type, payload): Promise<T>",
      "sendToTab(tabId, type, payload): void",
      "onMessage(callback): void"
    ]
  },
  "src/lib/filename.ts": {
    path: "src/lib/filename.ts",
    desc: "Dosya adı sanitizasyonu ve manipülasyonu; Windows'a uyumsuz karakterleri temizler, uzantı işlemleri yapar.",
    imports: [],
    vars: [],
    consts: [],
    funcs: [
      "sanitizeName(name): string",
      "formatFileName(baseName, extension): string",
      "joinPath(...parts): string",
      "getExtension(filename): string",
      "removeExtension(filename): string",
      "makeUnique(baseName, existingNames, extension): string"
    ]
  },
  "src/lib/export-io.ts": {
    path: "src/lib/export-io.ts",
    desc: "Delta sync için JSON export/import işlemleri; daha önce indirilmiş evrak bilgilerini takip eder, yeni evrakları tespit eder.",
    imports: [
      "ExportData, EvrakItem, DosyaBilgileri (@/types)",
      "EXPORT_FILE_NAME (./constants)"
    ],
    vars: [],
    consts: [],
    funcs: [
      "loadExistingExport(directoryHandle): Promise<ExportData | null>",
      "compareWithExisting(scannedEvraklar, existingExport): { yeni, mevcut }",
      "writeExportData(directoryHandle, exportData): Promise<void>",
      "createExportData(dosya, exportedBy): ExportData",
      "addDownloadedEvrak(exportData, evrak, fileName, mimeType, fileSize, status, error): ExportData"
    ]
  },
  "src/hooks/index.ts": {
    path: "src/hooks/index.ts",
    desc: "Hooks modülü barrel export dosyası; useToast ve useLocalStorage hook'larını re-export eder.",
    imports: [
      "useToast (./useToast) [re-export]",
      "useLocalStorage (./useLocalStorage) [re-export]"
    ],
    vars: [],
    consts: [],
    funcs: []
  },
  "src/hooks/useToast.ts": {
    path: "src/hooks/useToast.ts",
    desc: "Toast bildirim hook'u; zamanlayıcı ile otomatik kapanan mesaj gösterimi sağlar, Toast bileşenini döner.",
    imports: [
      "useState, useEffect, useCallback (preact/hooks)",
      "h (preact)",
      "Toast, ToastType, ToastState (@components/ui/Toast)"
    ],
    vars: [],
    consts: [],
    funcs: ["useToast(duration): { showToast, Toast }"]
  },
  "src/hooks/useLocalStorage.ts": {
    path: "src/hooks/useLocalStorage.ts",
    desc: "chrome.storage.local ile senkronize çalışan state hook'u; değer değiştiğinde otomatik chrome.storage'a yazar.",
    imports: ["useState, useEffect, useCallback (preact/hooks)"],
    vars: [],
    consts: [],
    funcs: ["useLocalStorage<T>(key, defaultValue): [T, setter, loading]"]
  },
  "src/components/index.ts": {
    path: "src/components/index.ts",
    desc: "Components modülü barrel export dosyası; tüm UI bileşenlerini (Button, Toast, EmptyState, Modal, Fab, ProgressBar, SessionAlert, Sidebar, EvrakCard, EvrakList, EvrakGroup) re-export eder.",
    imports: [
      "Button (./ui/Button) [re-export]",
      "Toast (./ui/Toast) [re-export]",
      "EmptyState (./ui/EmptyState) [re-export]",
      "Modal (./ui/Modal) [re-export]",
      "Fab (./ui/Fab) [re-export]",
      "ProgressBar (./ui/ProgressBar) [re-export]",
      "SessionAlert (./ui/SessionAlert) [re-export]",
      "Sidebar (./layout/Sidebar) [re-export]",
      "EvrakCard (./evrak/EvrakCard) [re-export]",
      "EvrakList (./evrak/EvrakList) [re-export]",
      "EvrakGroup (./evrak/EvrakGroup) [re-export]"
    ],
    vars: [],
    consts: [],
    funcs: []
  },
  "src/components/ui/Button.tsx": {
    path: "src/components/ui/Button.tsx",
    desc: "Yeniden kullanılabilir buton bileşeni; variant (primary/secondary/warning/danger) ve size (sm/md) destekler.",
    imports: ["ComponentChildren (preact)"],
    vars: [],
    consts: ["variantClasses", "sizeClasses", "baseClasses"],
    funcs: ["Button({ variant, size, fullWidth, disabled, class, onClick, children })"],
    extra: {
      title: "Type Tanımları",
      items: ["ButtonVariant (type)", "ButtonSize (type)", "ButtonProps (interface)"]
    }
  },
  "src/components/ui/Toast.tsx": {
    path: "src/components/ui/Toast.tsx",
    desc: "Bildirim toast bileşeni; error (kırmızı) ve success (yeşil) tiplerini destekler.",
    imports: [],
    vars: [],
    consts: ["typeClasses"],
    funcs: ["Toast({ notification })"],
    extra: {
      title: "Type Tanımları",
      items: ["ToastType (type: 'error' | 'success')", "ToastState (interface)"]
    }
  },
  "src/components/ui/EmptyState.tsx": {
    path: "src/components/ui/EmptyState.tsx",
    desc: "Boş durum bileşeni; mesaj ve opsiyonel ikon gösterir.",
    imports: ["ComponentChildren (preact)"],
    vars: [],
    consts: [],
    funcs: ["EmptyState({ message, icon })"],
    extra: {
      title: "Type Tanımları",
      items: ["EmptyStateProps (interface)"]
    }
  },
  "src/components/ui/Modal.tsx": {
    path: "src/components/ui/Modal.tsx",
    desc: "Modal overlay bileşeni; Escape tuşu ve backdrop tıklaması ile kapanır, children içeriğini gösterir.",
    imports: ["ComponentChildren (preact)", "useEffect, useCallback (preact/hooks)"],
    vars: [],
    consts: [],
    funcs: ["Modal({ open, onClose, title, children })"],
    extra: {
      title: "Type Tanımları",
      items: ["ModalProps (interface)"]
    }
  },
  "src/components/ui/Fab.tsx": {
    path: "src/components/ui/Fab.tsx",
    desc: "Floating Action Button bileşeni; sayfanın sağ alt köşesinde sabit konumlu 56x56px yuvarlak buton, SVG indirme ikonu içerir.",
    imports: [],
    vars: [],
    consts: [],
    funcs: ["Fab({ onClick })"],
    extra: {
      title: "Type Tanımları",
      items: ["FabProps (interface)"]
    }
  },
  "src/components/ui/ProgressBar.tsx": {
    path: "src/components/ui/ProgressBar.tsx",
    desc: "İndirme ilerleme çubuğu bileşeni; yüzde gösterimi, animasyonlu bar ve hata sayacı içerir.",
    imports: ["indirmeDurumu, indirmeYuzdesi (@store)"],
    vars: [],
    consts: [],
    funcs: ["ProgressBar()"]
  },
  "src/components/ui/SessionAlert.tsx": {
    path: "src/components/ui/SessionAlert.tsx",
    desc: "Oturum süresi doldu uyarı bileşeni; kırmızı alert kutusu ve 'Sayfayı Yenile' butonu içerir.",
    imports: ["sessionExpired (@store)", "Button (./Button)"],
    vars: [],
    consts: [],
    funcs: ["SessionAlert({ onClose })"],
    extra: {
      title: "Type Tanımları",
      items: ["SessionAlertProps (interface)"]
    }
  },
  "src/components/layout/Sidebar.tsx": {
    path: "src/components/layout/Sidebar.tsx",
    desc: "Ana içerik paneli (modal içinde); evrak listesi, tümünü seç/temizle butonları, indir/duraklat/iptal kontrolleri ve progress bar içerir.",
    imports: [
      "useState (preact/hooks)",
      "evraklar, seciliEvrakIds, seciliEvrakSayisi, indirmeDurumu, dosyaBilgileri, tumunuSec, secimiTemizle, sessionExpired (@store)",
      "Downloader (@content/downloader)",
      "EvrakList (@components/evrak/EvrakList)",
      "ProgressBar (@components/ui/ProgressBar)",
      "SessionAlert (@components/ui/SessionAlert)",
      "Button (@components/ui/Button)",
      "useToast (@hooks)"
    ],
    vars: [],
    consts: [],
    funcs: ["Sidebar({ onClose })"],
    extra: {
      title: "Type Tanımları",
      items: ["SidebarProps (interface)"]
    }
  },
  "src/components/evrak/EvrakCard.tsx": {
    path: "src/components/evrak/EvrakCard.tsx",
    desc: "Tekil evrak kartı bileşeni; checkbox seçimi, evrak adı, tür ve tarih bilgisini gösterir.",
    imports: ["EvrakItem (@/types)"],
    vars: [],
    consts: [],
    funcs: ["EvrakCard({ evrak, selected, onToggle })"],
    extra: {
      title: "Type Tanımları",
      items: ["EvrakCardProps (interface)"]
    }
  },
  "src/components/evrak/EvrakList.tsx": {
    path: "src/components/evrak/EvrakList.tsx",
    desc: "Evrak listesi bileşeni; evrakları klasör gruplarına göre gösterir, delta bilgisi (yeni/mevcut) başlığını içerir.",
    imports: [
      "grupluEvraklar, deltaInfo (@store)",
      "EvrakGroup (./EvrakGroup)",
      "EmptyState (@components/ui/EmptyState)"
    ],
    vars: [],
    consts: [],
    funcs: ["EvrakList()"]
  },
  "src/components/evrak/EvrakGroup.tsx": {
    path: "src/components/evrak/EvrakGroup.tsx",
    desc: "Klasör grubu bileşeni; açılır/kapanır klasör başlığı, toplu seçim checkbox'ı ve içindeki evrak kartları.",
    imports: [
      "useState (preact/hooks)",
      "EvrakItem (@/types)",
      "seciliEvrakIds, toggleEvrakSecimi, klasorEvraklariniSec, klasorEvraklariniKaldir (@store)",
      "EvrakCard (./EvrakCard)"
    ],
    vars: [],
    consts: [],
    funcs: ["EvrakGroup({ klasorAdi, evraklar })"],
    extra: {
      title: "Type Tanımları",
      items: ["EvrakGroupProps (interface)"]
    }
  },
  "src/content/index.tsx": {
    path: "src/content/index.tsx",
    desc: "Content script giriş noktası; FAB'ı render eder, MutationObserver ile UYAP dosya modal'ını izler, modal açıldığında evrak taraması başlatır.",
    imports: [
      "@/styles/sidebar.css",
      "SELECTORS (@lib)",
      "dosyaBilgileri, evraklar, kisiAdi, paginationInfo, sessionExpired (@store)",
      "render (preact)",
      "detectPagination, findKisiAdi, getDosyaBilgileri, scanFiletree, waitForFiletree (./scanner)",
      "App (./ui/App)"
    ],
    vars: ["appContainer", "isInitialized"],
    consts: [],
    funcs: [
      "waitForDosyaBilgileri(timeout): Promise<void>",
      "initExtension(): Promise<void>",
      "renderApp(): void",
      "cleanupExtension(): void",
      "isModalVisible(): boolean",
      "observeModal(): void"
    ]
  },
  "src/content/scanner.ts": {
    path: "src/content/scanner.ts",
    desc: "UYAP filetree DOM tarayıcısı; evrak bilgilerini çıkarır, Set ile deduplikasyon yapar, pagination tespit eder.",
    imports: [
      "EvrakItem, DosyaBilgileri, PaginationInfo (@/types)",
      "SELECTORS, SKIP_FOLDERS, DEFAULT_YARGI_TURU, sanitizeName (@lib)"
    ],
    vars: [],
    consts: [],
    funcs: [
      "getYargiTuru(): string",
      "findKisiAdi(): string",
      "getDosyaBilgileri(): DosyaBilgileri | null",
      "parseTooltip(tooltip): Record<string, string> [private]",
      "scanFiletree(): EvrakItem[]",
      "detectPagination(): PaginationInfo | null",
      "waitForFiletree(timeout): Promise<Element>"
    ]
  },
  "src/content/downloader.ts": {
    path: "src/content/downloader.ts",
    desc: "İndirme motoru; UYAP'tan fetch ile dosya indirir, Content-Type + magic bytes ile session tespiti yapar, base64'e çevirip background'a gönderir.",
    imports: [
      "EvrakItem, DosyaBilgileri, DownloadProgress, WriteFileResponse (@/types)",
      "getYargiTuru (./scanner)",
      "ayarlar, sessionExpired (@store)",
      "sendToBackground, UYAP_BASE_URL, DOWNLOAD_ENDPOINT, MAGIC_BYTES, MIME_TYPES, FILE_EXTENSIONS, RETRY_CONFIG (@lib)"
    ],
    vars: [],
    consts: [],
    funcs: [
      "matchBytes(header, magic): boolean [private]",
      "detectFileType(bytes): { mimeType, extension } [private]",
      "isHtmlResponse(bytes): boolean [private]",
      "arrayBufferToBase64(buffer): string [private]"
    ],
    extra: {
      title: "Class: Downloader",
      items: [
        "downloadAll(evraklar, dosya): Promise<void>",
        "downloadWithRetry(evrak, dosya): Promise<SingleDownloadResult> [private]",
        "downloadSingle(evrak, dosya): Promise<SingleDownloadResult> [private]",
        "pause(): void",
        "resume(): void",
        "cancel(): void",
        "getCurrentIndex(): number",
        "isPausedState(): boolean",
        "isCancelled(): boolean",
        "sleep(ms): Promise<void> [private]"
      ]
    }
  },
  "src/content/ui/App.tsx": {
    path: "src/content/ui/App.tsx",
    desc: "Kök UI bileşeni; FAB ve Modal'ı render eder, useState ile modal açma/kapama state'ini yönetir.",
    imports: [
      "useState (preact/hooks)",
      "Fab (@components/ui/Fab)",
      "Modal (@components/ui/Modal)",
      "Sidebar (@components/layout/Sidebar)"
    ],
    vars: [],
    consts: [],
    funcs: ["App()"]
  },
  "src/background/service-worker.ts": {
    path: "src/background/service-worker.ts",
    desc: "Background service worker giriş noktası; mesaj yönlendiricisini başlatır ve extension install/update olaylarını dinler.",
    imports: ["initMessageRouter (./message-router)"],
    vars: [],
    consts: [],
    funcs: []
  },
  "src/background/message-router.ts": {
    path: "src/background/message-router.ts",
    desc: "Mesaj yönlendirici; content/popup'tan gelen mesajları (GET/SET_DIRECTORY_HANDLE, GET/SET_SETTINGS, WRITE_FILE) ilgili handler'lara dağıtır.",
    imports: [
      "Message, WriteFilePayload (@/types)",
      "saveDirectoryHandle, loadDirectoryHandle, verifyDirectoryPermission (./idb-storage)",
      "STORAGE_KEYS (@lib)",
      "writeFileToDirectory (./file-writer)"
    ],
    vars: [],
    consts: [],
    funcs: [
      "initMessageRouter(): void",
      "handleMessage(message, sender): Promise<any> [private]",
      "handleGetDirectoryHandle(): Promise<{handle, hasPermission}> [private]",
      "handleSetDirectoryHandle(handle): Promise<{success}> [private]",
      "handleGetSettings(): Promise<any> [private]",
      "handleSetSettings(settings): Promise<{success}> [private]"
    ]
  },
  "src/background/file-writer.ts": {
    path: "src/background/file-writer.ts",
    desc: "Dosya yazıcı; base64 veriyi decode edip File System Access API ile hedef klasöre alt dizin yapısını oluşturarak yazar.",
    imports: [
      "WriteFilePayload, WriteFileResponse (@/types)",
      "loadDirectoryHandle, verifyDirectoryPermission (./idb-storage)",
      "sanitizeName (@lib)"
    ],
    vars: [],
    consts: [],
    funcs: [
      "base64ToUint8Array(base64): Uint8Array [private]",
      "writeFileToDirectory(payload): Promise<WriteFileResponse>"
    ]
  },
  "src/background/idb-storage.ts": {
    path: "src/background/idb-storage.ts",
    desc: "IndexedDB depolama katmanı; FileSystemDirectoryHandle'ı persist eder (chrome.storage serialize edemez) ve izin doğrulaması yapar.",
    imports: ["IDB_CONFIG (@lib)"],
    vars: ["dbInstance"],
    consts: [],
    funcs: [
      "openDB(): Promise<IDBDatabase> [private]",
      "saveDirectoryHandle(handle): Promise<void>",
      "loadDirectoryHandle(): Promise<FileSystemDirectoryHandle | null>",
      "verifyDirectoryPermission(handle): Promise<boolean>",
      "clearStorage(): Promise<void>"
    ]
  },
  "src/popup/index.html": {
    path: "src/popup/index.html",
    desc: "Popup HTML giriş dosyası; #app div'ine Preact uygulamasını yükler.",
    imports: ["../styles/popup.css (link)", "./index.tsx (script module)"],
    vars: [],
    consts: [],
    funcs: []
  },
  "src/popup/index.tsx": {
    path: "src/popup/index.tsx",
    desc: "Popup Preact giriş noktası; Popup bileşenini #app elementine render eder.",
    imports: ["render (preact)", "Popup (./Popup)"],
    vars: [],
    consts: [],
    funcs: []
  },
  "src/popup/Popup.tsx": {
    path: "src/popup/Popup.tsx",
    desc: "Popup ana bileşeni; klasör seçici (File System Access API), indirme gecikme/retry/klasör ayarları ve kullanım kılavuzu içerir.",
    imports: [
      "useState, useEffect (preact/hooks)",
      "sendToBackground, DEFAULT_SETTINGS (@lib)",
      "Settings (@/types)",
      "Button (@components/ui/Button)",
      "useToast (@hooks)"
    ],
    vars: [],
    consts: [],
    funcs: ["Popup()"]
  },
  "src/styles/sidebar.css": {
    path: "src/styles/sidebar.css",
    desc: "Content script için CSS; FAB, Modal overlay, panel layout, scrollbar ve progress bar animasyon stilleri.",
    imports: [],
    vars: [],
    consts: [],
    funcs: [],
    extra: {
      title: "CSS Sınıfları",
      items: [
        ".uyap-ext-panel (panel layout, flex column)",
        ".uyap-ext-fab (fixed, sağ alt, 56x56, yuvarlak, mavi)",
        ".uyap-ext-modal-overlay (fixed, tam ekran, siyah overlay)",
        ".uyap-ext-modal (beyaz kutu, 400px, rounded)",
        ".uyap-ext-modal-content (scroll alanı)",
        ".uyap-progress-bar-animated (çizgili animasyon)"
      ]
    }
  },
  "src/styles/popup.css": {
    path: "src/styles/popup.css",
    desc: "Popup için CSS; 360px genişlik, temel tipografi, scrollbar stilleri ve Tailwind directives.",
    imports: [],
    vars: [],
    consts: [],
    funcs: [],
    extra: {
      title: "CSS Tanımları",
      items: [
        ":root (width: 360px, min-height: 400px)",
        "body (font-family, font-size, color, background)",
        "::-webkit-scrollbar (6px, rounded)"
      ]
    }
  }
};

const TREE = [
  { name: "package.json", file: "package.json" },
  { name: "vite.config.ts", file: "vite.config.ts" },
  { name: "tailwind.config.ts", file: "tailwind.config.ts" },
  { name: "postcss.config.js", file: "postcss.config.js" },
  { name: "tsconfig.json", file: "tsconfig.json" },
  { name: "tsconfig.node.json", file: "tsconfig.node.json" },
  {
    name: "src",
    children: [
      { name: "manifest.ts", file: "src/manifest.ts" },
      {
        name: "types",
        children: [
          { name: "index.ts", file: "src/types/index.ts" },
          { name: "filesystem.d.ts", file: "src/types/filesystem.d.ts" }
        ]
      },
      {
        name: "store",
        children: [
          { name: "index.ts", file: "src/store/index.ts" },
          { name: "signals.ts", file: "src/store/signals.ts" }
        ]
      },
      {
        name: "lib",
        children: [
          { name: "index.ts", file: "src/lib/index.ts" },
          { name: "constants.ts", file: "src/lib/constants.ts" },
          { name: "messages.ts", file: "src/lib/messages.ts" },
          { name: "filename.ts", file: "src/lib/filename.ts" },
          { name: "export-io.ts", file: "src/lib/export-io.ts" }
        ]
      },
      {
        name: "hooks",
        children: [
          { name: "index.ts", file: "src/hooks/index.ts" },
          { name: "useToast.ts", file: "src/hooks/useToast.ts" },
          { name: "useLocalStorage.ts", file: "src/hooks/useLocalStorage.ts" }
        ]
      },
      {
        name: "components",
        children: [
          { name: "index.ts", file: "src/components/index.ts" },
          {
            name: "ui",
            children: [
              { name: "Button.tsx", file: "src/components/ui/Button.tsx" },
              { name: "Toast.tsx", file: "src/components/ui/Toast.tsx" },
              { name: "EmptyState.tsx", file: "src/components/ui/EmptyState.tsx" },
              { name: "Modal.tsx", file: "src/components/ui/Modal.tsx" },
              { name: "Fab.tsx", file: "src/components/ui/Fab.tsx" },
              { name: "ProgressBar.tsx", file: "src/components/ui/ProgressBar.tsx" },
              { name: "SessionAlert.tsx", file: "src/components/ui/SessionAlert.tsx" }
            ]
          },
          {
            name: "layout",
            children: [
              { name: "Sidebar.tsx", file: "src/components/layout/Sidebar.tsx" }
            ]
          },
          {
            name: "evrak",
            children: [
              { name: "EvrakCard.tsx", file: "src/components/evrak/EvrakCard.tsx" },
              { name: "EvrakList.tsx", file: "src/components/evrak/EvrakList.tsx" },
              { name: "EvrakGroup.tsx", file: "src/components/evrak/EvrakGroup.tsx" }
            ]
          }
        ]
      },
      {
        name: "content",
        children: [
          { name: "index.tsx", file: "src/content/index.tsx" },
          { name: "scanner.ts", file: "src/content/scanner.ts" },
          { name: "downloader.ts", file: "src/content/downloader.ts" },
          {
            name: "ui",
            children: [
              { name: "App.tsx", file: "src/content/ui/App.tsx" }
            ]
          }
        ]
      },
      {
        name: "background",
        children: [
          { name: "service-worker.ts", file: "src/background/service-worker.ts" },
          { name: "message-router.ts", file: "src/background/message-router.ts" },
          { name: "file-writer.ts", file: "src/background/file-writer.ts" },
          { name: "idb-storage.ts", file: "src/background/idb-storage.ts" }
        ]
      },
      {
        name: "popup",
        children: [
          { name: "index.html", file: "src/popup/index.html" },
          { name: "index.tsx", file: "src/popup/index.tsx" },
          { name: "Popup.tsx", file: "src/popup/Popup.tsx" }
        ]
      },
      {
        name: "styles",
        children: [
          { name: "sidebar.css", file: "src/styles/sidebar.css" },
          { name: "popup.css", file: "src/styles/popup.css" }
        ]
      }
    ]
  }
];

function getFileIconClass(name) {
  if (name.endsWith('.tsx')) return 'tsx';
  if (name.endsWith('.ts')) return 'ts';
  if (name.endsWith('.css')) return 'css';
  if (name.endsWith('.json')) return 'json';
  if (name.endsWith('.html')) return 'html';
  if (name.endsWith('.js')) return 'js';
  return '';
}

function getFileIcon(name) {
  const cls = getFileIconClass(name);
  const icons = {
    ts: 'TS',
    tsx: 'TX',
    css: 'CS',
    json: '{}',
    html: '<>',
    js: 'JS'
  };
  return icons[cls] || '--';
}

let activeFileEl = null;

function renderTree(container, nodes, depth) {
  nodes.forEach(node => {
    if (node.children) {
      const folder = document.createElement('div');
      folder.className = 'tree-folder';

      const header = document.createElement('div');
      header.className = 'tree-folder-header';
      header.style.paddingLeft = (8 + depth * 16) + 'px';

      const arrow = document.createElement('span');
      arrow.className = 'tree-arrow open';
      arrow.textContent = '\u25B6';

      const icon = document.createElement('span');
      icon.className = 'tree-folder-icon';
      icon.textContent = '\uD83D\uDCC1';

      const label = document.createElement('span');
      label.textContent = node.name;

      header.appendChild(arrow);
      header.appendChild(icon);
      header.appendChild(label);

      const childrenDiv = document.createElement('div');
      childrenDiv.className = 'tree-children open';

      header.addEventListener('click', () => {
        childrenDiv.classList.toggle('open');
        arrow.classList.toggle('open');
      });

      folder.appendChild(header);
      folder.appendChild(childrenDiv);
      container.appendChild(folder);

      renderTree(childrenDiv, node.children, depth + 1);
    } else {
      const fileEl = document.createElement('div');
      fileEl.className = 'tree-file';
      fileEl.style.paddingLeft = (28 + depth * 16) + 'px';

      const icon = document.createElement('span');
      icon.className = 'tree-file-icon ' + getFileIconClass(node.name);
      icon.textContent = getFileIcon(node.name);

      const label = document.createElement('span');
      label.textContent = node.name;

      fileEl.appendChild(icon);
      fileEl.appendChild(label);

      fileEl.addEventListener('click', () => {
        if (activeFileEl) activeFileEl.classList.remove('active');
        fileEl.classList.add('active');
        activeFileEl = fileEl;
        showDetail(node.file);
      });

      container.appendChild(fileEl);
    }
  });
}

function renderList(title, items, panel) {
  const section = document.createElement('div');
  section.className = 'detail-section';

  const h = document.createElement('div');
  h.className = 'detail-section-title';
  h.textContent = title;
  section.appendChild(h);

  if (!items || items.length === 0) {
    const none = document.createElement('div');
    none.className = 'detail-none';
    none.textContent = 'yok';
    section.appendChild(none);
  } else {
    const ul = document.createElement('ul');
    ul.className = 'detail-list';
    items.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      ul.appendChild(li);
    });
    section.appendChild(ul);
  }

  panel.appendChild(section);
}

function showDetail(fileKey) {
  const panel = document.getElementById('detail');
  const data = FILES[fileKey];

  if (!data) {
    panel.innerHTML = '<div class="detail-empty">Dosya bilgisi bulunamadı</div>';
    return;
  }

  panel.innerHTML = '';

  const pathEl = document.createElement('div');
  pathEl.className = 'detail-path';
  pathEl.textContent = data.path;
  panel.appendChild(pathEl);

  const titleEl = document.createElement('div');
  titleEl.className = 'detail-title';
  titleEl.textContent = data.path.split('/').pop();
  panel.appendChild(titleEl);

  const descEl = document.createElement('div');
  descEl.className = 'detail-desc';
  descEl.textContent = data.desc;
  panel.appendChild(descEl);

  renderList('İmport Edilen Modüller', data.imports, panel);
  renderList('Değişkenler', data.vars, panel);
  renderList('Sabitler', data.consts, panel);
  renderList('Fonksiyonlar / Bileşenler', data.funcs, panel);

  if (data.extra) {
    renderList(data.extra.title, data.extra.items, panel);
  }
}

// Initialize
renderTree(document.getElementById('tree'), TREE, 0);
  </script>
</body>
</html>
